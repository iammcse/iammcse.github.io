<script>

const queryString = window.location.search;
console.log("queryString: " + queryString);
// ?server=shirt&color=blue&newuser&size=m
const urlParams = new URLSearchParams(queryString);
const serverParam = urlParams.get("serverParam");
console.log('serverParam: ' + serverParam);
const morningParam = urlParams.get("morningParam");
console.log('morningParam: ' + morningParam);
const afternoonParam = urlParams.get("afternoonParam");
console.log('afternoonParam: ' + afternoonParam);

let offset = urlParams.get("offset");
//let offset = 0;

if (offset == null || offset == "" ){
  
  offset = 0; 

}
console.log('offset: ' + offset);

// Declare constants 
const ksc_URL = "https://kscgolf2.noq.com.hk/?noq_c=kscgolf&noq_r=https%3A%2F%2Fbooking.kscgolf.org.hk%2FwaitingRoom%3F";
//https://kscgolf2.noq.com.hk/?noq_c=kscgolf&noq_r=https%3A%2F%2Fbooking.kscgolf.org.hk%2FwaitingRoom
//const ksc_URL = "https://booking.kscgolf.org.hk/waitingRoom";

//7 numbers specify [year], [month], [day], [hour], [minute], [second], and [millisecond] (in that order)
const today = new Date();
const morningSession = new Date(today.getFullYear(),today.getMonth(),today.getDate(),9,30,0,0);
const afternoonSession = new Date(today.getFullYear(),today.getMonth(),today.getDate(),17,0,0,0);
const midnight = new Date(today.getFullYear(),today.getMonth(),today.getDate(),23,59,59,999);
// set number of seconds before launch

var offsetMilliSecondsValue = "0" ;
var afternoon_offsetMilliSecondsValue = "0" ;

const currentServer = {morning: 1550, afternoon: 575};



const KServer01 = {morning: 1160, afternoon: 760}; // M1132:PASS W1132:120 TH832:89 F:1132:123 M:1132:PASS Th:1132:85 F:1232:143 ST:115 SU:2032
const KServer02 = {morning: 760, afternoon: 760}; // M832:48 W832:42 TH832:52 F:1132:64 M:932:35 Th:932:106 F:1232:79 ST:107 SU:1932
const KServer03 = {morning: 960, afternoon: 760}; // M1132:PASS W1132:61 TH832:PASS F:1132:114 M:932:4 Th:932:5 F:1232:96 ST:112 SU:1832
const KServer04 = {morning: 760, afternoon: 760}; // M832:3 W832:136 TH832:66 F:1132:118 M:932:20 Th:932:PASS F:1232:21 ST:103 SU:1732
const KServer05 = {morning: 1160, afternoon: 760}; // M1132:PASS W1132:117 TH832:90 F:1132:110 M:1132:17 Th:1132:91 F:1232:20 ST:120 SU:1632
const KServer06 = {morning: 760, afternoon: 760}; // M832:PASS W832:63 TH832:91 F:1132:79 M:1132:26 Th:1132:96 F:1232:75 ST:51 SU:1532
const KServer07 = {morning: 960, afternoon: 760}; // M1132:22 W1132:128 TH832:26 F:1132:102 M:932:112 Th:932:PASS F:1232:87 ST:123 SU:1432
const KServer08 = {morning: 960, afternoon: 760}; // M832:9 W832:117 TH832:54 F:1132:88 M:932:8 Th:1132:92 F:1232:86 ST:57 SU:1332
const KServer09 = {morning: 760, afternoon: 760}; // M832:1 W832:38 TH832:15 F:1132:87 M:932:108 Th:1132:PASS F:1232:39 ST:132 SU:1332
const KServer10 = {morning: 960, afternoon: 760}; // M1132:29 W1132:23 TH832:92 F:1132:111 M:932:3 Th:932:102 F:1232:149 ST:PASS SU:1232
const KServer11 = {morning: 760, afternoon: 760}; // M832:PASS W832:7 TH832:44 F:1132:116 M:932:46 Th:932:103 F:1232:56 ST:130 SU:1132
const KServer12 = {morning: 1160, afternoon: 760}; // M1132:PASS W1132:126 TH832:105 F:1132:107 M:932:1 Th:932:113 F:1232:78 ST:145 SU:1032
const KServer13 = {morning: 760, afternoon: 760}; // M832:24 W832:31 TH832:34 F:1132:106 M:932:10 Th:932:21 F:1232:NONE3 ST:127 SU:932 
const KServer14 = {morning: 960, afternoon: 760}; // M1132:PASS W1132:137 TH832:29 F:1132:97 M:932:36 Th:1132:PASS F:1232:NONE63 ST:141 SU:832
const KServer15 = {morning: 760, afternoon: 760}; // M832:5 W832:114 TH832:51 F:1132:105 M:932:19 Th:1132:90 F:1232:NONE3 ST:142 SU:732
const KServer16 = {morning: 1160, afternoon: 760}; // M1132:PASS W1132:40 TH832:107 F:1132:PASS M:932:15 Th:1132:97 F:1232:NONE63 ST:96 SU:632



const my5600x = {morning: 960, afternoon: 760}; // 1410 Monday Afternoon 410 3 tabs proxied worked 
const win7ssd = {morning: 860, afternoon: 860}; //1410 720ms 1s x 2 3 tabs
const edge = {morning: 1160, afternoon: 760}; //1410 740:69
const brave = {morning: 960, afternoon:760}; //1410 afternoon 680 17ms 5 tab : PASSED

const Wildcard = {morning: 1160, afternoon: 760}; // M:455:ALLPASS :

const AllBraveKservers = {morning: 2932, afternoon: 639}; // 

switch(serverParam) {
  case "KServer01":
    currentServer.morning = KServer01.morning ;
    currentServer.afternoon = KServer01.afternoon;
    document.title = "KS01";
    console.log("switching KServer01");
      break;
  case "KServer02":
    currentServer.morning = KServer02.morning ;
    currentServer.afternoon = KServer02.afternoon;
    document.title = "KS02";
    console.log("switching KServer02");
    break;
  case "KServer03":
    currentServer.morning = KServer03.morning ;
    currentServer.afternoon = KServer03.afternoon;
    document.title = "KS03";
    console.log("switching KServer03");
  break;
  case "KServer04":
    currentServer.morning = KServer04.morning ;
    currentServer.afternoon = KServer04.afternoon;
    document.title = "KS04";
    console.log("switching KServer04");
  break;
  case "KServer05":
    currentServer.morning = KServer05.morning ;
    currentServer.afternoon = KServer05.afternoon;
    document.title = "KS05";
    console.log("switching KServer05");
  break;
  case "KServer06":
    currentServer.morning = KServer06.morning ;
    currentServer.afternoon = KServer06.afternoon;
    document.title = "KS06";
    console.log("switching KServer06");
  break;
  case "KServer07":
    currentServer.morning = KServer07.morning ;
    currentServer.afternoon = KServer07.afternoon;
    document.title = "KS07";
    console.log("switching KServer07");
  break;
  case "KServer08":
    currentServer.morning = KServer08.morning ;
    currentServer.afternoon = KServer08.afternoon;
    document.title = "KS08";
    console.log("switching KServer08");
  break;
  case "KServer09":
    currentServer.morning = KServer09.morning ;
    currentServer.afternoon = KServer09.afternoon;
    document.title = "KS09";
    console.log("switching KServer09");
  break;
  case "KServer10":
    currentServer.morning = KServer10.morning ;
    currentServer.afternoon = KServer10.afternoon;
    document.title = "KS10";
    console.log("switching KServer10");
  break;
  case "KServer11":
    currentServer.morning = KServer11.morning ;
    currentServer.afternoon = KServer11.afternoon;
    document.title = "KS11";
    console.log("switching KServer11");
  break;
  case "KServer12":
    currentServer.morning = KServer12.morning ;
    currentServer.afternoon = KServer12.afternoon;
    document.title = "KS12";
    console.log("switching KServer12");
  break;
  case "KServer13":
    currentServer.morning = KServer13.morning ;
    currentServer.afternoon = KServer13.afternoon;
    document.title = "KS13";
    console.log("switching KServer13");
  break;
  case "KServer14":
    currentServer.morning = KServer14.morning ;
    currentServer.afternoon = KServer14.afternoon;
    document.title = "KS14";
    console.log("switching KServer14");
  break;
  case "KServer15":
    currentServer.morning = KServer15.morning ;
    currentServer.afternoon = KServer15.afternoon;
    document.title = "KS15";
    console.log("switching KServer15");
  break;
  case "KServer16":
    currentServer.morning = KServer16.morning ;
    currentServer.afternoon = KServer16.afternoon;
    document.title = "KS16";
    console.log("switching KServer16");
  break;
  case "win7ssd":
    currentServer.morning = win7ssd.morning ;
    currentServer.afternoon = win7ssd.afternoon;
    document.title = "win7ssd";
    console.log("switching win7ssd");
  break;
  case "my5600x":
    currentServer.morning = my5600x.morning ;
    currentServer.afternoon = my5600x.afternoon;
    document.title = "my5600x";
    console.log("switching my5600x");
  break;
  case "edge":
    currentServer.morning = edge.morning ;
    currentServer.afternoon = edge.afternoon;
    document.title = "edge";
    console.log("switching edge");
  break;
  case "brave":
    currentServer.morning = brave.morning ;
    currentServer.afternoon = brave.afternoon;
    document.title = "brave";
    console.log("switching brave");
  break;
  case "AllBraveKservers":
    currentServer.morning = AllBraveKservers.morning ;
    currentServer.afternoon = AllBraveKservers.afternoon;
    document.title = "AllBraveKservers";
    console.log("switching AllBraveKservers");
  break;
  case "Wildcard":
    currentServer.morning = Wildcard.morning ;
    currentServer.afternoon = Wildcard.afternoon;
    document.title = "Wildcard";
    console.log("switching Wildcard");
  break;
  default:
  currentServer.morning = 2950;
  currentServer.afternoon = 2850;
  console.log("switching to Default");
}



if (morningParam !== null && morningParam !== "" && morningParam !== "0"){
   offsetMilliSecondsValue = Number(morningParam) + Number(offset); // Morning from Param 
   console.log("morningParam is NOT empty");
   console.log("morningParam: " + morningParam + " offset: " + offset);
}else{
   offsetMilliSecondsValue = Number(currentServer.morning) + Number(offset); // Morning default
   console.log("morningParam is empty");
   console.log("morningParam: " + currentServer.morning + " offset: " + offset);
}

if (afternoonParam !== null && afternoonParam !== "" && afternoonParam !== "0"){
   afternoon_offsetMilliSecondsValue =Number(afternoonParam) + Number(offset); // afternoon from Param
   console.log("afternoonParam is NOT Empty");
   console.log("afternoonParam: " + afternoonParam + " offset: " + offset);
}
else{
   afternoon_offsetMilliSecondsValue = Number(currentServer.afternoon) + Number(offset); // afternoon default
   console.log("afternoonParam is Empty");
   console.log("afternoonParam: " + currentServer.afternoon + " offset: " + offset);
}

console.log("offsetMilliSecondsValue: " + offsetMilliSecondsValue ); 

  // Get today's date and time 
  var now = new Date();
  var setHour = 0;
  var setMinute =0;
  var myInputTime = new Date();

  if (now.getTime() > morningSession.getTime() && now.getTime() <= afternoonSession.getTime() )    {
    myInputTime = afternoonSession - afternoon_offsetMilliSecondsValue;
    //console.log("myInputTime is : " + myInputTime);
  }
  else if (now.getTime() > afternoonSession && now.getTime() <= midnight) 
      {
      myInputTime = morningSession - offsetMilliSecondsValue + (1000 * 60 * 60 * 24);      
      console.log(myInputTime);
      //alert("midnight");
      }
  else  {myInputTime = morningSession - offsetMilliSecondsValue;}
  
 

// Set the date we're counting down to
//var countDownDate = new Date(myInputTime).getTime()
  var countDownDate = myInputTime;
// Find the subtractMilliSecondsValue between now and the count down date
  var subtractMilliSecondsValue = countDownDate - now.getTime();
  

// https://stackoverflow.com/questions/902713/how-do-i-programmatically-click-a-link-with-javascript
  
      var link ="https://booking.kscgolf.org.hk/waitingRoom";

  //function clickLink(link) {
        var cancelled = false;

        if (document.createEvent) {
            var event = document.createEvent("MouseEvents");
            event.initMouseEvent("click", true, true, window,
                0, 0, 0, 0, 0,
                false, false, false, false,
                0, null);
            cancelled = !link.dispatchEvent(event);
        }
        else if (link.fireEvent) {
            cancelled = !link.fireEvent("onclick");
        }

        if (!cancelled) {
            window.location = link.href;
        }
    }

   function timeToOpen() {
    //window.open(ksc_URL, "_self");
    
      //alert(myInputTime);
   }
   
   //setTimeout(timeToOpen, subtractMilliSecondsValue);
   //setTimeout(clickLink(link), subtractMilliSecondsValue);


console.log(subtractMilliSecondsValue);


function startTime() {
  var xPathRes = document.evaluate ('//*[@id="root"]/div[2]/div[2]/div/div/div[2]/a', document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null);
  xPathRes.singleNodeValue.click();
  
}
//setTimeout(function() {startTime()}, 3000);
setTimeout(function() {startTime()}, subtractMilliSecondsValue);

</script>


